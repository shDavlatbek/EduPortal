{% extends "layouts/main.html" %}
{% load static %}
{% load i18n %}

{% block content %}
<div class="container-fluid">
  <!-- Breadcrumbs and Title -->
  <div class="card bg-light-info shadow-none position-relative overflow-hidden mb-4">
    <div class="card-body p-0 m-0">
      <div class="row align-items-center">
        <div class="col-9">
          <h4 class="fw-semibold mb-8">{% trans "profile_settings" %}</h4>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">{% trans "dashboard" %}</a></li>
              <li class="breadcrumb-item active" aria-current="page">{% trans "profile" %}</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  {% if messages %}
  <div class="row">
    <div class="col-12">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }}" role="alert">
        {{ message }}
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Tabs for different sections -->
  <div class="card">
    <div class="card-body">
      <ul class="nav nav-tabs justify-content-center justify-content-xl-start" id="profileTabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'personal' %}active{% endif %}" id="personal-tab" data-bs-toggle="tab" href="#personal" role="tab" aria-controls="personal" aria-selected="{% if active_tab == 'personal' %}true{% else %}false{% endif %}">{% trans "personal_information" %}</a>
        </li>
        {% if role == 'student_group' %}
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'education' %}active{% endif %}" id="education-tab" data-bs-toggle="tab" href="#education" role="tab" aria-controls="education" aria-selected="{% if active_tab == 'education' %}true{% else %}false{% endif %}">{% trans "education" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'certificates' %}active{% endif %}" id="certificates-tab" data-bs-toggle="tab" href="#certificates" role="tab" aria-controls="certificates" aria-selected="{% if active_tab == 'certificates' %}true{% else %}false{% endif %}">{% trans "language_certificates" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'articles' %}active{% endif %}" id="articles-tab" data-bs-toggle="tab" href="#articles" role="tab" aria-controls="articles" aria-selected="{% if active_tab == 'articles' %}true{% else %}false{% endif %}">{% trans "articles" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'dissertation' %}active{% endif %}" id="dissertation-tab" data-bs-toggle="tab" href="#dissertation" role="tab" aria-controls="dissertation" aria-selected="{% if active_tab == 'dissertation' %}true{% else %}false{% endif %}">{% trans "dissertation" %}</a>
        </li>
        {% endif %}
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'password' %}active{% endif %}" id="password-tab" data-bs-toggle="tab" href="#password" role="tab" aria-controls="password" aria-selected="{% if active_tab == 'password' %}true{% else %}false{% endif %}">{% trans "change_password" %}</a>
        </li>
      </ul>

      <div class="tab-content mt-4" id="profileTabsContent">
        <!-- Personal Information Tab -->
        <div class="tab-pane fade {% if active_tab == 'personal' %}show active{% endif %}" id="personal" role="tabpanel" aria-labelledby="personal-tab">
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="profile">
            <input type="hidden" name="active_tab" id="profile_active_tab" value="personal">
            
            <div class="row">
              <div class="col-xl-3 mb-4">
                <div class="card">
                  <div class="card-body text-center">
                    <div class="position-relative">
                      <img src="{{ profile.picture.url }}" class="rounded-circle img-fluid mb-3" id="profile-picture-preview" style="width: 150px; height: 150px; object-fit: cover;">
                      <label for="id_picture" class="btn btn-sm btn-primary position-absolute bottom-0 end-0">
                        <i class="ti ti-camera"></i>
                      </label>
                      <input type="file" name="picture" id="id_picture" class="d-none" accept="image/*">
                    </div>
                    <h5 class="mt-3">{{ user.username }}</h5>
                    <p class="text-muted mb-1">{{ profile.full_name }}</p>
                    <p class="text-muted">{% translate role %}</p>
                  </div>
                </div>
              </div>
              
              <div class="col-xl-9">
                <div class="card">
                  <div class="card-body">
                    <h5 class="card-title mb-4">{% trans "personal_details" %}</h5>
                    
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="id_full_name" class="form-label">{% trans "full_name" %}</label>
                        <input type="text" class="form-control" id="id_full_name" name="full_name" value="{{ profile.full_name|default:'' }}">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="id_birth_date" class="form-label">{% trans "birth_date" %}</label>
                        <input type="date" class="form-control" id="id_birth_date" name="birth_date" value="{{ profile.birth_date|date:'Y-m-d'|default:'' }}">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="id_gender" class="form-label">{% trans "gender" %}</label>
                        <select class="form-select" id="id_gender" name="gender">
                          <option value="" {% if not profile.gender %}selected{% endif %}>{% trans "select_gender" %}</option>
                          <option value="male" {% if profile.gender == 'male' %}selected{% endif %}>{% trans "male" %}</option>
                          <option value="female" {% if profile.gender == 'female' %}selected{% endif %}>{% trans "female" %}</option>
                        </select>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="id_passport_number" class="form-label">{% trans "passport_number" %}</label>
                        <input type="text" class="form-control" id="id_passport_number" name="passport_number" value="{{ profile.passport_number|default:'' }}">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="id_birth_place" class="form-label">{% trans "birth_place" %}</label>
                        <input type="text" class="form-control" id="id_birth_place" name="birth_place" value="{{ profile.birth_place|default:'' }}">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="id_living_place" class="form-label">{% trans "living_place" %}</label>
                        <input type="text" class="form-control" id="id_living_place" name="living_place" value="{{ profile.living_place|default:'' }}">
                      </div>
                    </div>
                    <div class="text-end mt-4">
                      <button type="submit" class="btn btn-primary">{% trans "save_changes" %}</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
        
        {% if role == 'student_group' %}
        <!-- Education Tab -->
        <div class="tab-pane fade {% if active_tab == 'education' %}show active{% endif %}" id="education" role="tabpanel" aria-labelledby="education-tab">
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="form_type" value="education">
              <input type="hidden" name="active_tab" id="education_active_tab" value="education">
              
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title mb-4">{% trans "bachelor_degree" %}</h5>
                  
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="id_bachelor_major" class="form-label">{% trans "major" %}</label>
                      <input type="text" class="form-control" id="id_bachelor_major" name="bachelor_major" value="{{ education_profile.bachelor_major|default:'' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_bachelor_diploma" class="form-label">{% trans "diploma" %}</label>
                      <input type="text" class="form-control" id="id_bachelor_diploma" name="bachelor_diploma" value="{{ education_profile.bachelor_diploma|default:'' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_bachelor_diploma_date" class="form-label">{% trans "diploma_date" %}</label>
                      <input type="date" class="form-control" id="id_bachelor_diploma_date" name="bachelor_diploma_date" value="{{ education_profile.bachelor_diploma_date|date:'Y-m-d'|default:'' }}">
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="card mt-4">
                <div class="card-body">
                  <h5 class="card-title mb-4">{% trans "master_degree" %}</h5>
                  
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="id_master_major" class="form-label">{% trans "major" %}</label>
                      <input type="text" class="form-control" id="id_master_major" name="master_major" value="{{ education_profile.master_major|default:'' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_master_diploma" class="form-label">{% trans "diploma" %}</label>
                      <input type="text" class="form-control" id="id_master_diploma" name="master_diploma" value="{{ education_profile.master_diploma|default:'' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_master_diploma_date" class="form-label">{% trans "diploma_date" %}</label>
                      <input type="date" class="form-control" id="id_master_diploma_date" name="master_diploma_date" value="{{ education_profile.master_diploma_date|date:'Y-m-d'|default:'' }}">
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="card mt-4">
                <div class="card-body">
                  <h5 class="card-title mb-4">{% trans "next_education" %}</h5>
                  
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="id_next_education" class="form-label">{% trans "education_type" %}</label>
                      <select class="form-select" id="id_next_education" name="next_education">
                        <option value="" {% if not education_profile.next_education %}selected{% endif %}>{% trans "select_education_type" %}</option>
                        <option value="intern" {% if education_profile.next_education == 'intern' %}selected{% endif %}>{% trans "intern_researcher" %}</option>
                        <option value="phd" {% if education_profile.next_education == 'phd' %}selected{% endif %}>{% trans "phd" %}</option>
                        <option value="dsc" {% if education_profile.next_education == 'dsc' %}selected{% endif %}>{% trans "dsc" %}</option>
                        <option value="independent_phd" {% if education_profile.next_education == 'independent_phd' %}selected{% endif %}>{% trans "independent_phd" %}</option>
                        <option value="independent_dsc" {% if education_profile.next_education == 'independent_dsc' %}selected{% endif %}>{% trans "independent_dsc" %}</option>
                      </select>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_next_education_level" class="form-label">{% trans "education_level_course" %}</label>
                      <select class="form-select" id="id_next_education_level" name="next_education_level">
                        <option value="" {% if not education_profile.next_education_level %}selected{% endif %}>{% trans "Select Level" %}</option>
                        <option value="1" {% if education_profile.next_education_level == '1' %}selected{% endif %}>1</option>
                        <option value="2" {% if education_profile.next_education_level == '2' %}selected{% endif %}>2</option>
                        <option value="3" {% if education_profile.next_education_level == '3' %}selected{% endif %}>3</option>
                      </select>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_next_education_major" class="form-label">{% trans "Major" %}</label>
                      <select class="form-select" id="id_next_education_major" name="next_education_major">
                        <option value="">{% trans "Select Major" %}</option>
                        {% for major in education_majors %}
                        <option value="{{ major.id }}" {% if education_profile.next_education_major_id == major.id %}selected{% endif %}>{{ major.name }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="card mt-4">
                <div class="card-body">
                  <h5 class="card-title mb-4">{% trans "Teacher Information" %}</h5>
                  
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="id_teacher_full_name" class="form-label">{% trans "teacher_full_name" %}</label>
                      <input type="text" class="form-control" id="id_teacher_full_name" name="teacher_full_name" value="{{ education_profile.teacher_full_name|default:'' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_teacher_degree" class="form-label">{% trans "teacher_degree" %}</label>
                      <input type="text" class="form-control" id="id_teacher_degree" name="teacher_degree" value="{{ education_profile.teacher_degree|default:'' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_teacher_academic_rank" class="form-label">{% trans "teacher_academic_rank" %}</label>
                      <input type="text" class="form-control" id="id_teacher_academic_rank" name="teacher_academic_rank" value="{{ education_profile.teacher_academic_rank|default:'' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_teacher_work_place_position" class="form-label">{% trans "teacher_work_place_position" %}</label>
                      <input type="text" class="form-control" id="id_teacher_work_place_position" name="teacher_work_place_position" value="{{ education_profile.teacher_work_place_position|default:'' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_order_number" class="form-label">{% trans "order_number" %}</label>
                      <input type="text" class="form-control" id="id_order_number" name="order_number" value="{{ education_profile.order_number|default:'' }}">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="id_order_date" class="form-label">{% trans "order_date" %}</label>
                      <input type="date" class="form-control" id="id_order_date" name="order_date" value="{{ education_profile.order_date|date:'Y-m-d'|default:'' }}">
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="text-end mt-4">
                <button type="submit" class="btn btn-primary">{% trans "save_changes" %}</button>
              </div>
            </form>
        </div>
        
        
        <!-- Certificates Tab -->
        <div class="tab-pane fade {% if active_tab == 'certificates' %}show active{% endif %}" id="certificates" role="tabpanel" aria-labelledby="certificates-tab">
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="card-title">{% trans "language_certificates" %}</h5>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCertificateModal">
                  <i class="ti ti-plus"></i> {% trans "add_certificate" %}
                </button>
              </div>
              
              {% if language_certificates %}
              <div class="table-responsive">
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>{% trans "Certificate Name" %}</th>
                      <th>{% trans "Date" %}</th>
                      <th>{% trans "File" %}</th>
                      <th>{% trans "Actions" %}</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for cert in language_certificates %}
                    <tr>
                      <td>{{ forloop.counter }}</td>
                      <td>{{ cert.certificate_name }}</td>
                      <td>{{ cert.certificate_date|date:"Y-m-d"|default:"-" }}</td>
                      <td>
                        {% if cert.certificate_file %}
                        <a href="{{ cert.certificate_file.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                          <i class="ti ti-download"></i> {% trans "Download" %}
                        </a>
                        {% else %}
                        <span class="badge bg-warning">{% trans "No File" %}</span>
                        {% endif %}
                      </td>
                      <td>
                        <form method="post" class="d-inline">
                          {% csrf_token %}
                          <input type="hidden" name="form_type" value="certificate_delete">
                          <input type="hidden" name="certificate_id" value="{{ cert.id }}">
                          <input type="hidden" name="active_tab" value="certificates">
                          <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('{% trans "Are you sure you want to delete this certificate?" %}')">
                            <i class="ti ti-trash"></i>
                          </button>
                        </form>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              {% else %}
              <div class="alert alert-info">
                {% trans "not_any_language_certificates" %}
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        
        <!-- Articles Tab -->
        <div class="tab-pane fade {% if active_tab == 'articles' %}show active{% endif %}" id="articles" role="tabpanel" aria-labelledby="articles-tab">
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="card-title">{% trans "articles" %}</h5>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addArticleModal">
                  <i class="ti ti-plus"></i> {% trans "add_article" %}
                </button>
              </div>
              
              {% if articles %}
              <div class="table-responsive">
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>{% trans "type" %}</th>
                      <th>{% trans "number" %}</th>
                      <th>{% trans "date" %}</th>
                      <th>{% trans "file" %}</th>
                      <th>{% trans "actions" %}</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for article in articles %}
                    <tr>
                      <td>{{ forloop.counter }}</td>
                      <td>{% trans article.article_type %}</td>
                      <td>{{ article.article_number|default:"-" }}</td>
                      <td>{{ article.article_date|date:"Y-m-d"|default:"-" }}</td>
                      <td>
                        {% if article.article_file %}
                        <a href="{{ article.article_file.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                          <i class="ti ti-download"></i> {% trans "download" %}
                        </a>
                        {% else %}
                        <span class="badge bg-warning">{% trans "no_file" %}</span>
                        {% endif %}
                      </td>
                      <td>
                        <form method="post" class="d-inline">
                          {% csrf_token %}
                          <input type="hidden" name="form_type" value="article_delete">
                          <input type="hidden" name="article_id" value="{{ article.id }}">
                          <input type="hidden" name="active_tab" value="articles">
                          <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('{% trans "are_you_sure_you_want_to_delete_this_article?" %}')">
                            <i class="ti ti-trash"></i>
                          </button>
                        </form>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              {% else %}
              <div class="alert alert-info">
                {% trans "not_any_articles" %}
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        
        <!-- Dissertation Tab -->
        <div class="tab-pane fade {% if active_tab == 'dissertation' %}show active{% endif %}" id="dissertation" role="tabpanel" aria-labelledby="dissertation-tab">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title mb-4">{% trans "dissertation_information" %}</h5>
              
              <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="dissertation">
                <input type="hidden" name="active_tab" id="dissertation_active_tab" value="dissertation">
                
                <div class="row mb-4">
                  <div class="col-md-12">
                    <label for="id_dissertation_title" class="form-label">{% trans "dissertation_title" %}</label>
                    <input type="text" class="form-control" id="id_dissertation_title" name="dissertation_title" value="{{ dissertation.dissertation_title|default:'' }}">
                  </div>
                </div>
                
                <div class="row mb-4">
                  <div class="col-md-12">
                    <label for="id_dissertation_progress" class="form-label">{% trans "progress" %} (0-100%)</label>
                    <div class="input-group">
                      <input type="number" class="form-control" id="id_dissertation_progress" name="dissertation_progress" value="{{ dissertation.dissertation_progress|default:0 }}" min="0" max="100">
                      <span class="input-group-text">%</span>
                    </div>
                    
                    <div class="progress mt-2" style="height: 20px;">
                      <div class="progress-bar" role="progressbar" style="width: {{ dissertation.dissertation_progress }}%;" aria-valuenow="{{ dissertation.dissertation_progress }}" aria-valuemin="0" aria-valuemax="100">{{ dissertation.dissertation_progress }}%</div>
                    </div>
                  </div>
                </div>
                
                <div class="row mb-4">
                  <div class="col-md-12">
                    <label for="id_dissertation_file" class="form-label">{% trans "dissertation_file" %}</label>
                    <input type="file" class="form-control" id="id_dissertation_file" name="dissertation_file">
                    
                    {% if dissertation.dissertation_file %}
                    <div class="mt-2">
                      <a href="{{ dissertation.dissertation_file.url }}" target="_blank" class="btn btn-outline-primary">
                        <i class="ti ti-download"></i> {% trans "download_current_file" %}
                      </a>
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <div class="text-end mt-4">
                  <button type="submit" class="btn btn-primary">{% trans "save_changes" %}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        {% endif %}
        
        <!-- Password Change Tab -->
        <div class="tab-pane fade {% if active_tab == 'password' %}show active{% endif %}" id="password" role="tabpanel" aria-labelledby="password-tab">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title mb-4">{% trans "change_password" %}</h5>
              
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="password">
                <input type="hidden" name="active_tab" id="password_active_tab" value="password">
                
                <div class="row">
                  <div class="col-md-12 mb-3">
                    <label for="id_old_password" class="form-label">{% trans "current_password" %}</label>
                    <input type="password" class="form-control {% if password_form.old_password.errors %}is-invalid{% endif %}" id="id_old_password" name="old_password">
                    {% if password_form.old_password.errors %}
                    <div class="invalid-feedback">
                      {% for error in password_form.old_password.errors %}
                      {{ error }}
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                
                  <div class="col-md-12 mb-3">
                    <label for="id_new_password1" class="form-label">{% trans "new_password" %}</label>
                    <input type="password" class="form-control {% if password_form.new_password1.errors %}is-invalid{% endif %}" id="id_new_password1" name="new_password1">
                    {% if password_form.new_password1.errors %}
                    <div class="invalid-feedback">
                      {% for error in password_form.new_password1.errors %}
                      {{ error }}
                      {% endfor %}
                    </div>
                    {% endif %}
                    {% if not password_form.new_password1.errors %}
                    <div class="form-text text-muted">
                      <ul>
                        <li>{% trans "password_not_similar_to_other_personal_info" %}</li>
                        <li>{% trans "password_must_contain_minimum_8_characters" %}</li>
                        <li>{% trans "password_cannot_be_commonly_used" %}</li>
                        <li>{% trans "password_cannot_be_entirely_numeric" %}</li>
                      </ul>
                    </div>
                    {% endif %}
                  </div>
                
                  <div class="col-md-12 mb-3">
                    <label for="id_new_password2" class="form-label">{% trans "confirm_new_password" %}</label>
                    <input type="password" class="form-control {% if password_form.new_password2.errors %}is-invalid{% endif %}" id="id_new_password2" name="new_password2">
                    {% if password_form.new_password2.errors %}
                    <div class="invalid-feedback">
                      {% for error in password_form.new_password2.errors %}
                      {{ error }}
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <div class="text-end mt-4">
                  <button type="submit" class="btn btn-primary">{% trans "change_password" %}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Certificate Modal -->
<div class="modal fade" id="addCertificateModal" tabindex="-1" aria-labelledby="addCertificateModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="form_type" value="certificate_add">
        <input type="hidden" name="active_tab" value="certificates">
        
        <div class="modal-header">
          <h5 class="modal-title" id="addCertificateModalLabel">{% trans "add_language_certificate" %}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        
        <div class="modal-body">
          <div class="mb-3">
            <label for="id_certificate_name" class="form-label">{% trans "certificate_name" %} <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="id_certificate_name" name="certificate_name" required>
          </div>
          
          <div class="mb-3">
            <label for="id_certificate_date" class="form-label">{% trans "certificate_date" %}</label>
            <input type="date" class="form-control" id="id_certificate_date" name="certificate_date">
          </div>
          
          <div class="mb-3">
            <label for="id_certificate_file" class="form-label">{% trans "certificate_file" %}</label>
            <input type="file" class="form-control" id="id_certificate_file" name="certificate_file">
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "cancel" %}</button>
          <button type="submit" class="btn btn-primary">{% trans "save_certificate" %}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Add Article Modal -->
<div class="modal fade" id="addArticleModal" tabindex="-1" aria-labelledby="addArticleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="form_type" value="article_add">
        <input type="hidden" name="active_tab" value="articles">
        
        <div class="modal-header">
          <h5 class="modal-title" id="addArticleModalLabel">{% trans "add_article" %}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        
        <div class="modal-body">
          <div class="mb-3">
            <label for="id_article_type" class="form-label">{% trans "article_type" %} <span class="text-danger">*</span></label>
            <select class="form-select" id="id_article_type" name="article_type" required>
              <option value="">{% trans "select_article_type" %}</option>
              <option value="republic_scientific_journal">{% trans "republic_scientific_journal" %}</option>
              <option value="foreign_scientific_journal">{% trans "foreign_scientific_journal" %}</option>
              <option value="republic_conference_journal">{% trans "republic_conference_journal" %}</option>
              <option value="foreign_conference_journal">{% trans "foreign_conference_journal" %}</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label for="id_article_number" class="form-label">{% trans "article_number" %}</label>
            <input type="text" class="form-control" id="id_article_number" name="article_number">
          </div>
          
          <div class="mb-3">
            <label for="id_article_date" class="form-label">{% trans "article_date" %}</label>
            <input type="date" class="form-control" id="id_article_date" name="article_date">
          </div>
          
          <div class="mb-3">
            <label for="id_article_file" class="form-label">{% trans "article_file" %}</label>
            <input type="file" class="form-control" id="id_article_file" name="article_file">
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "cancel" %}</button>
          <button type="submit" class="btn btn-primary">{% trans "save_article" %}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- JavaScript for image preview and tab state management -->
{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Profile picture preview
    const pictureInput = document.getElementById('id_picture');
    const picturePreview = document.getElementById('profile-picture-preview');
    
    if (pictureInput && picturePreview) {
      pictureInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            picturePreview.src = e.target.result;
          }
          
          reader.readAsDataURL(this.files[0]);
        }
      });
    }
    
    // Progress bar update for dissertation
    const progressInput = document.getElementById('id_dissertation_progress');
    const progressBar = document.querySelector('.progress-bar');
    
    if (progressInput && progressBar) {
      progressInput.addEventListener('input', function() {
        const value = this.value;
        progressBar.style.width = value + '%';
        progressBar.setAttribute('aria-valuenow', value);
        progressBar.textContent = value + '%';
      });
    }
    
    // Tab state management
    const tabLinks = document.querySelectorAll('a[data-bs-toggle="tab"]');
    const activeTabFields = document.querySelectorAll('input[name="active_tab"]');
    
    // Update active tab in hidden fields when tab is clicked
    tabLinks.forEach(function(tabLink) {
      tabLink.addEventListener('shown.bs.tab', function(e) {
        const tabId = e.target.getAttribute('href').replace('#', '');
        
        // Update all active_tab hidden fields
        activeTabFields.forEach(function(field) {
          field.value = tabId;
        });
      });
    });
  });
</script>
{% endblock %}
{% endblock content %}